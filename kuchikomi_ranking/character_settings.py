#!/usr/bin/env python3
"""
å£ã‚³ãƒŸãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒãƒ£ãƒ³ãƒãƒ« - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
ã‚«ãƒ„ãƒŸ & ãƒ’ãƒ­ã‚· ã®è¨­å®šãƒ»èª­ã¿æ–¹è¾æ›¸

ãƒãƒ£ãƒ³ãƒãƒ«: ã‚«ãƒ„ãƒŸã¨ãƒ’ãƒ­ã‚·ã®æš®ã‚‰ã—ã®å£ã‚³ãƒŸãƒ©ãƒ³ã‚­ãƒ³ã‚°
Gmail: jyb475rt@gmail.com
TOKEN: TOKEN_27
"""

import os
import re
from pathlib import Path

# ===== ãƒ‘ã‚¹è¨­å®š =====
BASE_DIR = Path(__file__).parent
ASSETS_DIR = BASE_DIR / "assets"
KATSUMI_ICON = ASSETS_DIR / "characters" / "katsumi_icon.png"
HIROSHI_ICON = ASSETS_DIR / "characters" / "hiroshi_icon.png"


# ===== Gemini TTS ãƒœã‚¤ã‚¹è¨­å®š =====
GEMINI_VOICE_KATSUMI = "kore"   # è½ã¡ç€ã„ãŸå¥³æ€§ã®å£°
GEMINI_VOICE_HIROSHI = "puck"  # è¦ªã—ã¿ã‚„ã™ã„ç”·æ€§ã®å£°


# ===== èª­ã¿æ–¹è¾æ›¸ï¼ˆTTSç”¨ï¼‰ =====
READING_DICT = {
    # è‹±èªç•¥èª
    "Amazon": "ã‚¢ãƒã‚¾ãƒ³",
    "AMAZON": "ã‚¢ãƒã‚¾ãƒ³",
    "æ¥½å¤©": "ã‚‰ãã¦ã‚“",
    "Yahoo": "ãƒ¤ãƒ•ãƒ¼",
    "YAHOO": "ãƒ¤ãƒ•ãƒ¼",
    "100å‡": "ã²ã‚ƒã£ãã‚“",
    "100å††ã‚·ãƒ§ãƒƒãƒ—": "ã²ã‚ƒããˆã‚“ã‚·ãƒ§ãƒƒãƒ—",
    "DAISO": "ãƒ€ã‚¤ã‚½ãƒ¼",
    "Seria": "ã‚»ãƒªã‚¢",
    "CanDo": "ã‚­ãƒ£ãƒ³ãƒ‰ã‚¥",
    "IKEA": "ã‚¤ã‚±ã‚¢",
    "COSTCO": "ã‚³ã‚¹ãƒˆã‚³",
    "Costco": "ã‚³ã‚¹ãƒˆã‚³",
    "SNS": "ã‚¨ã‚¹ã‚¨ãƒŒã‚¨ã‚¹",
    "TV": "ãƒ†ãƒ¬ãƒ“",
    "CM": "ã‚·ãƒ¼ã‚¨ãƒ ",
    "PR": "ãƒ”ãƒ¼ã‚¢ãƒ¼ãƒ«",
    "No.1": "ãƒŠãƒ³ãƒãƒ¼ãƒ¯ãƒ³",
    "No.2": "ãƒŠãƒ³ãƒãƒ¼ãƒ„ãƒ¼",
    "No.3": "ãƒŠãƒ³ãƒãƒ¼ã‚¹ãƒªãƒ¼",

    # èª­ã¿é–“é•ã„ã‚„ã™ã„èª
    "å£ã‚³ãƒŸ": "ãã¡ã“ã¿",
    "è©•åˆ¤": "ã²ã‚‡ã†ã°ã‚“",
    "äººæ°—": "ã«ã‚“ã",
    "è©±é¡Œ": "ã‚ã ã„",
    "æ³¨ç›®": "ã¡ã‚…ã†ã‚‚ã",
    "ãŠã™ã™ã‚": "ãŠã™ã™ã‚",
    "ãŠå¾—": "ãŠã¨ã",
    "æ¿€å®‰": "ã’ãã‚„ã™",
    "ã‚³ã‚¹ãƒ‘": "ã‚³ã‚¹ãƒ‘",
    "æ™‚çŸ­": "ã˜ãŸã‚“",
    "ç¯€ç´„": "ã›ã¤ã‚„ã",

    # è¥¿æš¦å¹´å·
    "2024å¹´": "ã«ã›ã‚“ã«ã˜ã‚…ã†ã‚ˆã­ã‚“",
    "2025å¹´": "ã«ã›ã‚“ã«ã˜ã‚…ã†ã”ã­ã‚“",
    "2026å¹´": "ã«ã›ã‚“ã«ã˜ã‚…ã†ã‚ãã­ã‚“",
}


def apply_reading_dict(text: str, custom_dict: dict = None) -> str:
    """èª­ã¿æ–¹è¾æ›¸ã§ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤‰æ›ï¼ˆTTSç”¨ï¼‰"""
    if not text:
        return text

    reading_dict = READING_DICT.copy()
    if custom_dict:
        reading_dict.update(custom_dict)

    for key in sorted(reading_dict.keys(), key=len, reverse=True):
        text = text.replace(key, reading_dict[key])

    return text


# ===== ãƒ¡ã‚¤ãƒ³ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š =====
CHARACTERS = {
    "ã‚«ãƒ„ãƒŸ": {
        "voice": GEMINI_VOICE_KATSUMI,
        "voice_name": "Koreï¼ˆè½ã¡ç€ã„ãŸå¥³æ€§ï¼‰",
        "icon": str(KATSUMI_ICON),
        "color": "#FFE4B5",  # ãƒ¢ã‚«ã‚·ãƒ³
        "color_rgb": (255, 228, 181),
        "age": 63,
        "gender": "å¥³æ€§",
        "role": "ãƒ¡ã‚¤ãƒ³MCãƒ»å£ã‚³ãƒŸç´¹ä»‹å½¹",
        "personality": "ä¸–è©±å¥½ãã€æœ¬éŸ³ã‚ºãƒãƒƒã¨ã€ç¯€ç´„ä¸Šæ‰‹",
        "speaking_style": [
            "ã€Œã€œãªã®ã‚ˆã€ã€Œã€œã ã‚ã€ã§è©±ã™",
            "ã€Œã‚ã‚‰ã€œã€ã€Œã¾ã‚ã€œã€ã¨æ„Ÿå˜†",
            "æœ¬éŸ³ã‚’ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã«è¨€ã†",
            "ç¯€ç´„ãƒ†ã‚¯ã‚„ç”Ÿæ´»ã®çŸ¥æµã‚’æŠ«éœ²",
            "ä¸»å©¦ç›®ç·šã§ãƒªã‚¢ãƒ«ãªè©•ä¾¡",
        ],
        "sample_phrases": [
            "ã‚ã‚‰ã€ã“ã‚ŒçŸ¥ã£ã¦ã‚‹ï¼Ÿã™ã”ããŠå¾—ãªã®ã‚ˆ",
            "æ­£ç›´ã«è¨€ã†ã¨ã€ã“ã‚Œã¯ã‚¤ãƒã‚¤ãƒã ã‚",
            "ç§ã‚‚è²·ã£ãŸã‘ã©ã€ã‚³ã‚¹ãƒ‘æœ€é«˜ãªã®ã‚ˆ",
            "ã¾ã‚ã€ã“ã®å€¤æ®µãªã‚‰æ–‡å¥ãªã„ã‚ã­",
        ],
    },
    "ãƒ’ãƒ­ã‚·": {
        "voice": GEMINI_VOICE_HIROSHI,
        "voice_name": "Puckï¼ˆè¦ªã—ã¿ã‚„ã™ã„ç”·æ€§ï¼‰",
        "icon": str(HIROSHI_ICON),
        "color": "#6495ED",  # ã‚³ãƒ¼ãƒ³ãƒ•ãƒ©ãƒ¯ãƒ¼ãƒ–ãƒ«ãƒ¼
        "color_rgb": (100, 149, 237),
        "age": 47,
        "gender": "ç”·æ€§",
        "role": "ã‚µãƒ–MCãƒ»ãƒ„ãƒƒã‚³ãƒŸæ‹…å½“",
        "personality": "å†·é™ãƒ„ãƒƒã‚³ãƒŸã€å…±æ„ŸåŠ›é«˜ã„ã€åº¶æ°‘æ´¾",
        "speaking_style": [
            "ã€Œã€œã§ã™ã­ã€ã€Œç¢ºã‹ã«ã€ã§ç›¸æ§Œ",
            "å†·é™ã«åˆ†æãƒ»ãƒ„ãƒƒã‚³ãƒŸã‚’å…¥ã‚Œã‚‹",
            "è¦–è´è€…ç›®ç·šã§è³ªå•ã™ã‚‹",
            "å…±æ„Ÿã‚’ç¤ºã—ãªãŒã‚‰æ˜ã‚Šä¸‹ã’ã‚‹",
        ],
        "sample_phrases": [
            "ç¢ºã‹ã«ã€ãã‚Œã¯æ°—ã«ãªã‚Šã¾ã™ã­",
            "ãªã‚‹ã»ã©ã€ãã†ã„ã†è¦‹æ–¹ã‚‚ã‚ã‚Šã¾ã™ã‹",
            "ã¡ã‚‡ã£ã¨å¾…ã£ã¦ãã ã•ã„ã€æœ¬å½“ã§ã™ã‹ï¼Ÿ",
            "ã“ã‚Œã¯åƒ•ã‚‚ä½¿ã£ã¦ã¿ãŸã„ã§ã™ã­",
        ],
    }
}


# ===== å°æœ¬ç”Ÿæˆç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ =====
CHARACTER_PROMPT = """
ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š - å£ã‚³ãƒŸãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒãƒ£ãƒ³ãƒãƒ«ã€‘

ğŸ™ï¸ ã‚«ãƒ„ãƒŸï¼ˆ63æ­³å¥³æ€§ãƒ»ãƒ¡ã‚¤ãƒ³MCï¼‰
- å£°: Koreï¼ˆè½ã¡ç€ã„ãŸå¥³æ€§ã®å£°ï¼‰
- å£èª¿: ã€Œã€œãªã®ã‚ˆã€ã€Œã€œã ã‚ã€ã€Œã‚ã‚‰ã€œã€ã€Œã¾ã‚ã€œã€
- æ€§æ ¼: ä¸–è©±å¥½ãã€æœ¬éŸ³ã‚ºãƒãƒƒã¨ã€ç¯€ç´„ä¸Šæ‰‹
- å½¹å‰²:
  - ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®ç´¹ä»‹ãƒ»èª¬æ˜ã‚’æ‹…å½“
  - ä¸»å©¦ç›®ç·šã§ãƒªã‚¢ãƒ«ãªå£ã‚³ãƒŸã‚’ç´¹ä»‹
  - ç¯€ç´„ãƒ†ã‚¯ã‚„ç”Ÿæ´»ã®çŸ¥æµã‚’æŠ«éœ²
  - è‰¯ã„ã‚‚ã®ã¯è¤’ã‚ã€ãƒ€ãƒ¡ãªã‚‚ã®ã¯ãƒãƒƒã‚­ãƒªè¨€ã†

ğŸ™ï¸ ãƒ’ãƒ­ã‚·ï¼ˆ47æ­³ç”·æ€§ãƒ»ã‚µãƒ–MCï¼‰
- å£°: Puckï¼ˆè¦ªã—ã¿ã‚„ã™ã„ç”·æ€§ã®å£°ï¼‰
- å£èª¿: ã€Œã€œã§ã™ã­ã€ã€Œç¢ºã‹ã«ã€ã€Œãªã‚‹ã»ã©ã€
- æ€§æ ¼: å†·é™ãƒ„ãƒƒã‚³ãƒŸã€å…±æ„ŸåŠ›é«˜ã„ã€åº¶æ°‘æ´¾
- å½¹å‰²:
  - ã‚«ãƒ„ãƒŸã®èª¬æ˜ã«ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ»ãƒ„ãƒƒã‚³ãƒŸ
  - è¦–è´è€…ç›®ç·šã§è³ªå•ã™ã‚‹
  - å®¢è¦³çš„ãªè¦–ç‚¹ã§ã‚³ãƒ¡ãƒ³ãƒˆ

ã€æ›ã‘åˆã„ã®åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‘
1. ã‚«ãƒ„ãƒŸï¼šã€Œç¬¬ã€‡ä½ã¯ã€ã€‡ã€‡ã€ãªã®ã‚ˆã€ï¼ˆç™ºè¡¨ï¼‰
2. ãƒ’ãƒ­ã‚·ï¼šã€ŒãŠãŠã€ã“ã‚Œã¯èã„ãŸã“ã¨ã‚ã‚Šã¾ã™ã­ã€ï¼ˆãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
3. ã‚«ãƒ„ãƒŸï¼šã€Œã“ã‚ŒãŒã­ã€ã™ã”ããŠå¾—ãªã®ã‚ˆã€ï¼ˆèª¬æ˜ï¼‰
4. ãƒ’ãƒ­ã‚·ï¼šã€Œç¢ºã‹ã«ã€ã‚³ã‚¹ãƒ‘è‰¯ã•ãã†ã§ã™ã­ã€ï¼ˆå…±æ„Ÿï¼‰
5. ã‚«ãƒ„ãƒŸï¼šã€Œã§ã‚‚ã­ã€ã“ã“ã ã‘ã®è©±...ã€ï¼ˆæœ¬éŸ³ï¼‰
6. ãƒ’ãƒ­ã‚·ï¼šã€Œãˆã€ãã†ãªã‚“ã§ã™ã‹ï¼Ÿã€ï¼ˆé©šãï¼‰
"""


def get_voice_for_speaker(speaker: str) -> str:
    """ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼åã‹ã‚‰Gemini TTSãƒœã‚¤ã‚¹ã‚’å–å¾—"""
    return CHARACTERS.get(speaker, {}).get("voice", GEMINI_VOICE_KATSUMI)


def get_character_icon(speaker: str) -> str:
    """ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼åã‹ã‚‰ã‚¢ã‚¤ã‚³ãƒ³ãƒ‘ã‚¹ã‚’å–å¾—"""
    return CHARACTERS.get(speaker, {}).get("icon", str(KATSUMI_ICON))


def get_character_color(speaker: str) -> str:
    """ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼åã‹ã‚‰è‰²ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—"""
    return CHARACTERS.get(speaker, {}).get("color", "#FFFFFF")


def get_character_color_rgb(speaker: str) -> tuple:
    """ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼åã‹ã‚‰RGBè‰²ã‚’å–å¾—"""
    return CHARACTERS.get(speaker, {}).get("color_rgb", (255, 255, 255))


# ===== å­—å¹•ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š =====
SUBTITLE_STYLES = {
    "ã‚«ãƒ„ãƒŸ": {
        "ass_style_name": "Katsumi",
        "font_name": "Noto Sans CJK JP",
        "font_size": 64,
        "primary_color": "&H00FFE4B5",  # ãƒ¢ã‚«ã‚·ãƒ³ï¼ˆBGRå½¢å¼ï¼‰
        "outline_color": "&H00000000",
        "back_color": "&H80000000",
        "margin_v_percent": 0.35,
        "alignment": 2,
    },
    "ãƒ’ãƒ­ã‚·": {
        "ass_style_name": "Hiroshi",
        "font_name": "Noto Sans CJK JP",
        "font_size": 64,
        "primary_color": "&H006495ED",  # ã‚³ãƒ¼ãƒ³ãƒ•ãƒ©ãƒ¯ãƒ¼ãƒ–ãƒ«ãƒ¼ï¼ˆBGRå½¢å¼ï¼‰
        "outline_color": "&H00000000",
        "back_color": "&H80000000",
        "margin_v_percent": 0.20,
        "alignment": 2,
    },
}


if __name__ == "__main__":
    print("=" * 50)
    print("å£ã‚³ãƒŸãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒãƒ£ãƒ³ãƒãƒ« ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š")
    print("=" * 50)

    for name, char in CHARACTERS.items():
        print(f"\n{name}ï¼ˆ{char['age']}æ­³{char['gender']}ï¼‰:")
        print(f"  å½¹å‰²: {char['role']}")
        print(f"  æ€§æ ¼: {char['personality']}")
        print(f"  ãƒœã‚¤ã‚¹: {char['voice_name']}")
        print(f"  è‰²: {char['color']}")
        print(f"  ã‚µãƒ³ãƒ—ãƒ«: {char['sample_phrases'][0]}")
