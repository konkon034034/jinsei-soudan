# 音声とテキスト（字幕）のズレ修正ガイド

## 問題の原因

- 文字数推定は不正確
- チャンク境界でズレる
- ASS字幕のタイミング計算がズレる

## 解決方法

### 方法1: 実測値を使う（推奨）

```python
from pydub import AudioSegment
audio = AudioSegment.from_file(audio_path)
actual_duration_ms = len(audio)
```

音声ファイルを直接読み込み、実際の長さをミリ秒単位で取得する。
推定ではなく実測値なので最も正確。

### 方法2: Whisper/STTで発話タイミング検出

音声認識APIを使って発話の開始・終了タイミングを検出する。
各セリフの正確なタイミングが取得できるが、処理時間とAPI料金がかかる。

### 方法3: 画像焼き付け方式（最も確実）

字幕を動画フレームに直接焼き付ける方式。
ASS字幕のタイミング問題を完全に回避できる。
ただし実装の手間がかかる。

## チャンクサイズ

- 15セリフ/チャンクで声質統一OK
- 小さすぎると声質バラバラになる
- 大きすぎるとAPI制限に引っかかる

## nenkin_news.pyの設定

- TTS: Gemini 2.5 Flash TTS
- カツミ: Kore
- ヒロシ: Puck
- チャンクサイズ: 15

## 優先順位

1. まず実測値方式（pydub）を試す
2. ダメならWhisper/STTで発話タイミング検出
3. 完璧を求めるなら画像焼き付け方式
