name: Test Radio („Çå„Åß„ÅÉ„Åä„Åç„Åô„Åæ„ÅÑ „ÉÜ„Çπ„Éà)

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    
    env:
      YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
      YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
      YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN_14 }}
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg
          pip install google-auth google-auth-oauthlib google-api-python-client requests
      
      - name: Create test video and upload
        run: |
          ffmpeg -f lavfi -i color=c=black:s=1920x1080:d=30 -f lavfi -i anullsrc=r=44100:cl=stereo -t 30 -c:v libx264 -c:a aac -shortest test_video.mp4
          
          python3 << 'EOF'
          import os
          import requests
          from google.oauth2.credentials import Credentials
          from googleapiclient.discovery import build
          from googleapiclient.http import MediaFileUpload
          
          client_id = os.environ["YOUTUBE_CLIENT_ID"]
          client_secret = os.environ["YOUTUBE_CLIENT_SECRET"]
          refresh_token = os.environ["YOUTUBE_REFRESH_TOKEN"]
          
          token_url = "https://oauth2.googleapis.com/token"
          response = requests.post(token_url, data={
              "client_id": client_id,
              "client_secret": client_secret,
              "refresh_token": refresh_token,
              "grant_type": "refresh_token"
          })
          access_token = response.json()["access_token"]
          print("‚úÖ „Ç¢„ÇØ„Çª„Çπ„Éà„Éº„ÇØ„É≥ÂèñÂæóÊàêÂäü")
          
          credentials = Credentials(
              token=access_token,
              refresh_token=refresh_token,
              token_uri=token_url,
              client_id=client_id,
              client_secret=client_secret
          )
          
          youtube = build("youtube", "v3", credentials=credentials)
          
          body = {
              "snippet": {
                  "title": "„ÉÜ„Çπ„ÉàÂãïÁîª - „Çå„Åß„ÅÉ„Åä„Åç„Åô„Åæ„ÅÑ",
                  "description": "30Áßí„ÅÆ„ÉÜ„Çπ„ÉàÂãïÁîª„Åß„Åô„ÄÇ",
                  "categoryId": "22"
              },
              "status": {
                  "privacyStatus": "unlisted",
                  "selfDeclaredMadeForKids": False
              }
          }
          
          media = MediaFileUpload("test_video.mp4", mimetype="video/mp4", resumable=True)
          request = youtube.videos().insert(part="snippet,status", body=body, media_body=media)
          
          response = None
          while response is None:
              status, response = request.next_chunk()
              if status:
                  print(f"ÈÄ≤Êçó: {int(status.progress() * 100)}%")
          
          print(f"üéâ „Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊàêÂäüÔºÅ")
          print(f"üì∫ URL: https://www.youtube.com/watch?v={response['id']}")
          EOF
