name: Update .env file

on:
  workflow_dispatch:

jobs:
  update-env:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Generate .env file
        env:
          GEMINI_API_KEY_1: ${{ secrets.GEMINI_API_KEY_1 }}
          GEMINI_API_KEY_2: ${{ secrets.GEMINI_API_KEY_2 }}
          GEMINI_API_KEY_3: ${{ secrets.GEMINI_API_KEY_3 }}
          GEMINI_API_KEY_4: ${{ secrets.GEMINI_API_KEY_4 }}
          GEMINI_API_KEY_5: ${{ secrets.GEMINI_API_KEY_5 }}
          GEMINI_API_KEY_6: ${{ secrets.GEMINI_API_KEY_6 }}
          GEMINI_API_KEY_7: ${{ secrets.GEMINI_API_KEY_7 }}
          GEMINI_API_KEY_8: ${{ secrets.GEMINI_API_KEY_8 }}
          GEMINI_API_KEY_9: ${{ secrets.GEMINI_API_KEY_9 }}
          GEMINI_API_KEY_10: ${{ secrets.GEMINI_API_KEY_10 }}
          GEMINI_API_KEY_11: ${{ secrets.GEMINI_API_KEY_11 }}
          GEMINI_API_KEY_12: ${{ secrets.GEMINI_API_KEY_12 }}
          GEMINI_API_KEY_13: ${{ secrets.GEMINI_API_KEY_13 }}
          GEMINI_API_KEY_14: ${{ secrets.GEMINI_API_KEY_14 }}
          GEMINI_API_KEY_15: ${{ secrets.GEMINI_API_KEY_15 }}
          GEMINI_API_KEY_16: ${{ secrets.GEMINI_API_KEY_16 }}
          GEMINI_API_KEY_17: ${{ secrets.GEMINI_API_KEY_17 }}
          GEMINI_API_KEY_18: ${{ secrets.GEMINI_API_KEY_18 }}
          GEMINI_API_KEY_19: ${{ secrets.GEMINI_API_KEY_19 }}
          GEMINI_API_KEY_20: ${{ secrets.GEMINI_API_KEY_20 }}
          GEMINI_API_KEY_21: ${{ secrets.GEMINI_API_KEY_21 }}
          GEMINI_API_KEY_22: ${{ secrets.GEMINI_API_KEY_22 }}
          GEMINI_API_KEY_23: ${{ secrets.GEMINI_API_KEY_23 }}
          GEMINI_API_KEY_24: ${{ secrets.GEMINI_API_KEY_24 }}
          GEMINI_API_KEY_25: ${{ secrets.GEMINI_API_KEY_25 }}
          GEMINI_API_KEY_26: ${{ secrets.GEMINI_API_KEY_26 }}
          GEMINI_API_KEY_27: ${{ secrets.GEMINI_API_KEY_27 }}
          GEMINI_API_KEY_28: ${{ secrets.GEMINI_API_KEY_28 }}
          GEMINI_API_KEY_29: ${{ secrets.GEMINI_API_KEY_29 }}
          GEMINI_API_KEY_30: ${{ secrets.GEMINI_API_KEY_30 }}
          GEMINI_API_KEY_31: ${{ secrets.GEMINI_API_KEY_31 }}
          GEMINI_API_KEY_32: ${{ secrets.GEMINI_API_KEY_32 }}
          GEMINI_API_KEY_33: ${{ secrets.GEMINI_API_KEY_33 }}
          GEMINI_API_KEY_34: ${{ secrets.GEMINI_API_KEY_34 }}
          GEMINI_API_KEY_35: ${{ secrets.GEMINI_API_KEY_35 }}
          GEMINI_API_KEY_36: ${{ secrets.GEMINI_API_KEY_36 }}
          GEMINI_API_KEY_37: ${{ secrets.GEMINI_API_KEY_37 }}
          GEMINI_API_KEY_38: ${{ secrets.GEMINI_API_KEY_38 }}
          GEMINI_API_KEY_39: ${{ secrets.GEMINI_API_KEY_39 }}
          GEMINI_API_KEY_40: ${{ secrets.GEMINI_API_KEY_40 }}
          GEMINI_API_KEY_41: ${{ secrets.GEMINI_API_KEY_41 }}
          GEMINI_API_KEY_42: ${{ secrets.GEMINI_API_KEY_42 }}
          GEMINI_API_KEY_43: ${{ secrets.GEMINI_API_KEY_43 }}
        run: |
          cat << 'EOF' > .env
          GEMINI_API_KEY_1=${GEMINI_API_KEY_1}
          GEMINI_API_KEY_2=${GEMINI_API_KEY_2}
          GEMINI_API_KEY_3=${GEMINI_API_KEY_3}
          GEMINI_API_KEY_4=${GEMINI_API_KEY_4}
          GEMINI_API_KEY_5=${GEMINI_API_KEY_5}
          GEMINI_API_KEY_6=${GEMINI_API_KEY_6}
          GEMINI_API_KEY_7=${GEMINI_API_KEY_7}
          GEMINI_API_KEY_8=${GEMINI_API_KEY_8}
          GEMINI_API_KEY_9=${GEMINI_API_KEY_9}
          GEMINI_API_KEY_10=${GEMINI_API_KEY_10}
          GEMINI_API_KEY_11=${GEMINI_API_KEY_11}
          GEMINI_API_KEY_12=${GEMINI_API_KEY_12}
          GEMINI_API_KEY_13=${GEMINI_API_KEY_13}
          GEMINI_API_KEY_14=${GEMINI_API_KEY_14}
          GEMINI_API_KEY_15=${GEMINI_API_KEY_15}
          GEMINI_API_KEY_16=${GEMINI_API_KEY_16}
          GEMINI_API_KEY_17=${GEMINI_API_KEY_17}
          GEMINI_API_KEY_18=${GEMINI_API_KEY_18}
          GEMINI_API_KEY_19=${GEMINI_API_KEY_19}
          GEMINI_API_KEY_20=${GEMINI_API_KEY_20}
          GEMINI_API_KEY_21=${GEMINI_API_KEY_21}
          GEMINI_API_KEY_22=${GEMINI_API_KEY_22}
          GEMINI_API_KEY_23=${GEMINI_API_KEY_23}
          GEMINI_API_KEY_24=${GEMINI_API_KEY_24}
          GEMINI_API_KEY_25=${GEMINI_API_KEY_25}
          GEMINI_API_KEY_26=${GEMINI_API_KEY_26}
          GEMINI_API_KEY_27=${GEMINI_API_KEY_27}
          GEMINI_API_KEY_28=${GEMINI_API_KEY_28}
          GEMINI_API_KEY_29=${GEMINI_API_KEY_29}
          GEMINI_API_KEY_30=${GEMINI_API_KEY_30}
          GEMINI_API_KEY_31=${GEMINI_API_KEY_31}
          GEMINI_API_KEY_32=${GEMINI_API_KEY_32}
          GEMINI_API_KEY_33=${GEMINI_API_KEY_33}
          GEMINI_API_KEY_34=${GEMINI_API_KEY_34}
          GEMINI_API_KEY_35=${GEMINI_API_KEY_35}
          GEMINI_API_KEY_36=${GEMINI_API_KEY_36}
          GEMINI_API_KEY_37=${GEMINI_API_KEY_37}
          GEMINI_API_KEY_38=${GEMINI_API_KEY_38}
          GEMINI_API_KEY_39=${GEMINI_API_KEY_39}
          GEMINI_API_KEY_40=${GEMINI_API_KEY_40}
          GEMINI_API_KEY_41=${GEMINI_API_KEY_41}
          GEMINI_API_KEY_42=${GEMINI_API_KEY_42}
          GEMINI_API_KEY_43=${GEMINI_API_KEY_43}
          EOF

          # 環境変数を展開
          envsubst < .env > .env.tmp && mv .env.tmp .env

          echo "Generated .env with $(wc -l < .env) lines"

      - name: Commit and push .env
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .env
          git diff --staged --quiet || git commit -m "Update .env with Gemini API keys"
          git push
