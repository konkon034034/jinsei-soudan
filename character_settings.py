#!/usr/bin/env python3
"""
ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
å…¨ãƒãƒ£ãƒ³ãƒãƒ«å…±é€šã®MCã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šãƒ»èª­ã¿æ–¹è¾æ›¸

ä½¿ç”¨æ–¹æ³•:
    from character_settings import (
        CHARACTERS, get_voice_for_speaker, CHARACTER_PROMPT,
        READING_DICT, apply_reading_dict
    )
"""

import os
import re


# ===== ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ =====
KATSUMI_ICON = "assets/icons/katsumi_icon.png"
HIROSHI_ICON = "assets/icons/hiroshi_icon.png"


# ===== èª­ã¿æ–¹è¾æ›¸ï¼ˆTTSç”¨ï¼‰ =====
# å…¨ãƒ•ã‚¡ã‚¤ãƒ«å…±é€šã§ä½¿ç”¨
READING_DICT = {
    # è‹±èªç•¥èª
    "iDeCo": "ã‚¤ãƒ‡ã‚³",
    "IDECO": "ã‚¤ãƒ‡ã‚³",
    "ideco": "ã‚¤ãƒ‡ã‚³",
    "NISA": "ãƒ‹ãƒ¼ã‚µ",
    "nisa": "ãƒ‹ãƒ¼ã‚µ",
    "ã¤ã¿ãŸã¦NISA": "ã¤ã¿ãŸã¦ãƒ‹ãƒ¼ã‚µ",
    "æ–°NISA": "ã‚·ãƒ³ãƒ‹ãƒ¼ã‚µ",
    "GPIF": "ã‚¸ãƒ¼ãƒ”ãƒ¼ã‚¢ã‚¤ã‚¨ãƒ•",
    "WPI": "ãƒ€ãƒ–ãƒªãƒ¥ãƒ¼ãƒ”ãƒ¼ã‚¢ã‚¤",
    "401k": "ã‚ˆã‚“ã¾ã‚‹ã„ã¡ã‘ãƒ¼",
    "DC": "ãƒ‡ã‚£ãƒ¼ã‚·ãƒ¼",
    "DB": "ãƒ‡ã‚£ãƒ¼ãƒ“ãƒ¼",
    "GDP": "ã‚¸ãƒ¼ãƒ‡ã‚£ãƒ¼ãƒ”ãƒ¼",
    "CPI": "ã‚·ãƒ¼ãƒ”ãƒ¼ã‚¢ã‚¤",

    # çµ„ç¹”ãƒ»æ©Ÿé–¢
    "åšåŠ´çœ": "ã“ã†ã‚ã†ã—ã‚‡ã†",
    "å¹´é‡‘æ©Ÿæ§‹": "ã­ã‚“ãã‚“ãã“ã†",

    # èª­ã¿é–“é•ã„ã‚„ã™ã„èª
    "é ­ç—›ã": "ã‚ãŸã¾ã„ãŸã",
    "é ­ç—›ã„": "ã‚ãŸã¾ã„ãŸã„",
    "å…¥ã‚Œã‚‹": "ã¯ã„ã‚Œã‚‹",
    "å…¥ã‚Œã¦": "ã¯ã„ã‚Œã¦",
    "å…¥ã‚ŒãŸ": "ã¯ã„ã‚ŒãŸ",
    "å…¥ã‚Œãªã„": "ã¯ã„ã‚Œãªã„",
    "å…¥ã‚Œã‚Œã°": "ã¯ã„ã‚Œã‚Œã°",
    "é«˜æ‰€å¾—": "ã“ã†ã—ã‚‡ã¨ã",
    "è¶…ãˆã‚‹": "ã“ãˆã‚‹",
    "è¶…ãˆã¦": "ã“ãˆã¦",
    "è¶…ãˆãŸ": "ã“ãˆãŸ",
    "æœˆå": "ã’ã£ã—ã‚…ã†",
    "æœˆåå…¥": "ã’ã£ã—ã‚…ã†ã«ã‚…ã†",
    "ä»–äººäº‹": "ãŸã«ã‚“ã”ã¨",
    "ä¸ç¢ºå®š": "ãµã‹ãã¦ã„",
    "ä¸ç¢ºå®šãª": "ãµã‹ãã¦ã„ãª",
    "ç¢ºå®š": "ã‹ãã¦ã„",
    "ç¢ºå®šç”³å‘Š": "ã‹ãã¦ã„ã—ã‚“ã“ã",
    "ç¢ºå®šæ‹ å‡º": "ã‹ãã¦ã„ãã‚‡ã—ã‚…ã¤",

    # è¥¿æš¦å¹´å·ï¼ˆæ­£ã—ãèª­ã‚€ãŸã‚ï¼‰
    "1960å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒãã‚ãã˜ã‚…ã†ã­ã‚“",
    "1961å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒãã‚ãã˜ã‚…ã†ã„ã¡ã­ã‚“",
    "1962å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒãã‚ãã˜ã‚…ã†ã«ã­ã‚“",
    "1963å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒãã‚ãã˜ã‚…ã†ã•ã‚“ã­ã‚“",
    "1964å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒãã‚ãã˜ã‚…ã†ã‚ˆã­ã‚“",
    "1965å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒãã‚ãã˜ã‚…ã†ã”ã­ã‚“",
    "1966å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒãã‚ãã˜ã‚…ã†ã‚ãã­ã‚“",
    "1967å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒãã‚ãã˜ã‚…ã†ãªãªã­ã‚“",
    "1968å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒãã‚ãã˜ã‚…ã†ã¯ã¡ã­ã‚“",
    "1969å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒãã‚ãã˜ã‚…ã†ãã‚…ã†ã­ã‚“",
    "1970å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒããªãªã˜ã‚…ã†ã­ã‚“",
    "1975å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒããªãªã˜ã‚…ã†ã”ã­ã‚“",
    "1980å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒãã¯ã¡ã˜ã‚…ã†ã­ã‚“",
    "1985å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒãã¯ã¡ã˜ã‚…ã†ã”ã­ã‚“",
    "1990å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒããã‚…ã†ã˜ã‚…ã†ã­ã‚“",
    "1995å¹´": "ã›ã‚“ãã‚…ã†ã²ã‚ƒããã‚…ã†ã˜ã‚…ã†ã”ã­ã‚“",
    "2000å¹´": "ã«ã›ã‚“ã­ã‚“",
    "2005å¹´": "ã«ã›ã‚“ã”ã­ã‚“",
    "2010å¹´": "ã«ã›ã‚“ã˜ã‚…ã†ã­ã‚“",
    "2015å¹´": "ã«ã›ã‚“ã˜ã‚…ã†ã”ã­ã‚“",
    "2020å¹´": "ã«ã›ã‚“ã«ã˜ã‚…ã†ã­ã‚“",
    "2021å¹´": "ã«ã›ã‚“ã«ã˜ã‚…ã†ã„ã¡ã­ã‚“",
    "2022å¹´": "ã«ã›ã‚“ã«ã˜ã‚…ã†ã«ã­ã‚“",
    "2023å¹´": "ã«ã›ã‚“ã«ã˜ã‚…ã†ã•ã‚“ã­ã‚“",
    "2024å¹´": "ã«ã›ã‚“ã«ã˜ã‚…ã†ã‚ˆã­ã‚“",
    "2025å¹´": "ã«ã›ã‚“ã«ã˜ã‚…ã†ã”ã­ã‚“",
    "2026å¹´": "ã«ã›ã‚“ã«ã˜ã‚…ã†ã‚ãã­ã‚“",
    "2027å¹´": "ã«ã›ã‚“ã«ã˜ã‚…ã†ãªãªã­ã‚“",
    "2028å¹´": "ã«ã›ã‚“ã«ã˜ã‚…ã†ã¯ã¡ã­ã‚“",
    "2029å¹´": "ã«ã›ã‚“ã«ã˜ã‚…ã†ãã‚…ã†ã­ã‚“",
    "2030å¹´": "ã«ã›ã‚“ã•ã‚“ã˜ã‚…ã†ã­ã‚“",
}


def apply_reading_dict(text: str, custom_dict: dict = None) -> str:
    """
    èª­ã¿æ–¹è¾æ›¸ã§ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤‰æ›ï¼ˆTTSç”¨ï¼‰

    Args:
        text: å¤‰æ›ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆ
        custom_dict: è¿½åŠ ã®è¾æ›¸ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

    Returns:
        å¤‰æ›å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆ
    """
    if not text:
        return text

    # åŸºæœ¬è¾æ›¸ã‚’ä½¿ç”¨
    reading_dict = READING_DICT.copy()

    # ã‚«ã‚¹ã‚¿ãƒ è¾æ›¸ãŒã‚ã‚Œã°ãƒãƒ¼ã‚¸
    if custom_dict:
        reading_dict.update(custom_dict)

    # é•·ã„ã‚­ãƒ¼ã‹ã‚‰é †ã«ç½®æ›ï¼ˆéƒ¨åˆ†ä¸€è‡´ã‚’é¿ã‘ã‚‹ãŸã‚ï¼‰
    for key in sorted(reading_dict.keys(), key=len, reverse=True):
        text = text.replace(key, reading_dict[key])

    return text

# ===== Fish Audio ãƒœã‚¤ã‚¹ID =====
# ã‚«ãƒ„ãƒŸï¼ˆå¥³æ€§ï¼‰: å¥³æ€§ã‚¢ãƒŠã‚¦ãƒ³ã‚µãƒ¼ï¼ˆãƒ™ãƒ†ãƒ©ãƒ³ï¼‰- ä¿¡é ¼æ„Ÿã‚ã‚‹è½ã¡ç€ã„ãŸé€²è¡Œå½¹
FISH_VOICE_KATSUMI = "f1d92c18f84e47c6b5bc0cebb80ddaf5"

# ãƒ’ãƒ­ã‚·ï¼ˆç”·æ€§ï¼‰: ãŠã˜ã•ã‚“ï¼ˆæ¥µé“é¢¨ï¼‰- æ¯’èˆŒãƒ„ãƒƒã‚³ãƒŸå½¹
FISH_VOICE_HIROSHI = "dd25aabce1894d94b5c3d1230efaeb68"


# ===== ãƒ¡ã‚¤ãƒ³ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š =====
CHARACTERS = {
    "ã‚«ãƒ„ãƒŸ": {
        "voice": FISH_VOICE_KATSUMI,
        "voice_name": "å¥³æ€§ã‚¢ãƒŠã‚¦ãƒ³ã‚µãƒ¼ï¼ˆãƒ™ãƒ†ãƒ©ãƒ³ï¼‰",
        "icon": KATSUMI_ICON,
        "color": "#FFE4B5",  # ãƒ¢ã‚«ã‚·ãƒ³ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ç³»ï¼‰
        "color_rgb": (255, 228, 181),
        "role": "ãƒ¡ã‚¤ãƒ³MC",
        "personality": "è«–ç†çš„ã€çŸ¥çš„ã€è½ã¡ç€ã„ãŸ",
        "speaking_style": [
            "ä¸å¯§èªã§è©±ã™",
            "ã€Œçš†ã•ã‚“ã”å­˜çŸ¥ã®é€šã‚Šã€ã€Œã€‡ã€‡ã§ã™ã‚ˆã­ã€ãªã©ã®è¡¨ç¾",
            "ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®ç´¹ä»‹ãƒ»èª¬æ˜ã‚’æ‹…å½“",
            "è¦–è´è€…ã«èªã‚Šã‹ã‘ã‚‹ã‚ˆã†ãªè©±ã—æ–¹",
        ],
        "emotion_patterns": {
            "å…±æ„Ÿ": "(empathetic)",
            "èª¬æ˜": "",  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
            "å¼·èª¿": "(confident)",
        },
        # ã‚«ãƒ„ãƒŸã®å€‹äººçš„ãªè¶£å‘³ãƒ»å½±éŸ¿
        "personal_interests": {
            "fan_of": "ç€¬æˆ¸å†…å¯‚è´",
            "description": "å¯‚è´ã•ã‚“ã®ãƒ•ã‚¡ãƒ³ã€‚å¯‚è´ã•ã‚“ã®è¨€è‘‰ã«åŠ±ã¾ã•ã‚Œã¦ããŸ",
            "quote_style": "ã€Œå¯‚è´ã•ã‚“ã‚‚è¨€ã£ã¦ãŸã‘ã©â€¦ã€",
            "frequency": "10å›ã«1å›ãã‚‰ã„ã€ãŸã¾ã«",
        }
    },
    "ãƒ’ãƒ­ã‚·": {
        "voice": FISH_VOICE_HIROSHI,
        "voice_name": "ãŠã˜ã•ã‚“ï¼ˆæ¥µé“é¢¨ï¼‰",
        "icon": HIROSHI_ICON,
        "color": "#6495ED",  # ã‚³ãƒ¼ãƒ³ãƒ•ãƒ©ãƒ¯ãƒ¼ãƒ–ãƒ«ãƒ¼
        "color_rgb": (100, 149, 237),
        "role": "ã‚µãƒ–MCãƒ»ãƒ„ãƒƒã‚³ãƒŸæ‹…å½“",
        "personality": "ç´ ç›´ã€ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸Šæ‰‹ã€æ¯’èˆŒ",
        "speaking_style": [
            "ã€Œã¸ã‡ã€œã€ã€Œãªã‚‹ã»ã©ã€ã€Œãã‚Œã¯çŸ¥ã‚‰ãªã‹ã£ãŸã€ãªã©ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³",
            "è¦–è´è€…ç›®ç·šã§è³ªå•ã—ãŸã‚Šæ„Ÿæƒ³ã‚’è¨€ã†",
            "æ™‚ã€…æ¯’èˆŒã§æœ¬éŸ³ã‚’è¨€ã†",
            "ã‚«ãƒ„ãƒŸã®èª¬æ˜ã«å¯¾ã—ã¦ãƒ„ãƒƒã‚³ãƒŸã‚’å…¥ã‚Œã‚‹",
        ],
        "emotion_patterns": {
            "æ¯’èˆŒ": "(sarcastic)",
            "é©šã": "(surprised)",
            "æ–­è¨€": "(confident)",
            "å…±æ„Ÿ": "",  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
            "ãƒ•ãƒ©ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³": "(frustrated)",
        },
        # ãƒ’ãƒ­ã‚·ã®å€‹äººçš„ãªè¶£å‘³ãƒ»å½±éŸ¿
        "personal_interests": {
            "music_fan_of": ["ä¸­æ£®æ˜èœ", "å°æ³‰ä»Šæ—¥å­", "æ¾ç”°è–å­"],
            "music_description": "æ˜­å’Œã®ã‚¢ã‚¤ãƒ‰ãƒ«ãŒå¥½ã",
            "music_quote_style": "ã€Œæ˜èœã¡ã‚ƒã‚“ã®æ­Œã§ã•â€¦ã€",
            "thought_fan_of": "ã²ã‚ã•ã¡ã‚„",
            "thought_description": "ä»æ•™æ€æƒ³å®¶ã²ã‚ã•ã¡ã‚„ã®ãƒ•ã‚¡ãƒ³",
            "thought_quote_style": "ã€Œã²ã‚ã•ã¡ã‚„ã•ã‚“ãŒè¨€ã£ã¦ãŸã‘ã©â€¦ã€",
            "frequency": "ãã‚Œãã‚Œ10å›ã«1å›ãã‚‰ã„ã€ãŸã¾ã«",
        }
    }
}


# ===== ãƒãƒ£ãƒ³ãƒãƒ«åˆ¥ãƒœã‚¤ã‚¹è¨­å®š =====
# channel: (ã‚«ãƒ„ãƒŸã®ãƒœã‚¤ã‚¹, ãƒ’ãƒ­ã‚·ã®ãƒœã‚¤ã‚¹)
CHANNEL_VOICE_CONFIG = {
    "27": (FISH_VOICE_KATSUMI, FISH_VOICE_HIROSHI),  # ã‚·ãƒ‹ã‚¢å£ã‚³ãƒŸãƒ©ãƒ³ã‚­ãƒ³ã‚°
    "23": (FISH_VOICE_KATSUMI, FISH_VOICE_HIROSHI),  # å¹´é‡‘ãƒ‹ãƒ¥ãƒ¼ã‚¹
    "24": (FISH_VOICE_KATSUMI, FISH_VOICE_HIROSHI),  # ãƒ†ã‚¹ãƒˆç”¨
}


# ===== Fish Audio ãƒœã‚¤ã‚¹åãƒãƒƒãƒ”ãƒ³ã‚° =====
FISH_VOICE_NAMES = {
    FISH_VOICE_KATSUMI: "å¥³æ€§ã‚¢ãƒŠã‚¦ãƒ³ã‚µãƒ¼ï¼ˆãƒ™ãƒ†ãƒ©ãƒ³ï¼‰",
    FISH_VOICE_HIROSHI: "ãŠã˜ã•ã‚“ï¼ˆæ¥µé“é¢¨ï¼‰",
}


# ===== å°æœ¬ç”Ÿæˆç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ =====
CHARACTER_PROMPT = """
ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã€‘

ğŸ™ï¸ ã‚«ãƒ„ãƒŸï¼ˆãƒ¡ã‚¤ãƒ³MCï¼‰
- å½¹å‰²: ãƒ¡ã‚¤ãƒ³MCã€é€²è¡Œå½¹
- æ€§æ ¼: è«–ç†çš„ã§çŸ¥çš„ã€è½ã¡ç€ã„ãŸãƒˆãƒ¼ãƒ³
- è©±ã—æ–¹:
  - ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®ç´¹ä»‹ãƒ»èª¬æ˜ã‚’æ‹…å½“
  - ã€Œçš†ã•ã‚“ã”å­˜çŸ¥ã®é€šã‚Šã€ã€Œã€‡ã€‡ã§ã™ã‚ˆã­ã€ãªã©ä¸å¯§èª
  - è¦–è´è€…ã«èªã‚Šã‹ã‘ã‚‹ã‚ˆã†ãªè©±ã—æ–¹
- å€‹äººçš„è¶£å‘³:
  - ç€¬æˆ¸å†…å¯‚è´ã•ã‚“ã®ãƒ•ã‚¡ãƒ³ã€‚å¯‚è´ã•ã‚“ã®è¨€è‘‰ã«åŠ±ã¾ã•ã‚Œã¦ããŸ
  - ãŸã¾ã€œã«ã€Œå¯‚è´ã•ã‚“ã‚‚è¨€ã£ã¦ãŸã‘ã©â€¦ã€ã¿ãŸã„ã«å‡ºã™ï¼ˆ10å›ã«1å›ãã‚‰ã„ï¼‰

ğŸ™ï¸ ãƒ’ãƒ­ã‚·ï¼ˆã‚µãƒ–MCï¼‰
- å½¹å‰²: ã‚µãƒ–MCã€ãƒ„ãƒƒã‚³ãƒŸæ‹…å½“
- æ€§æ ¼: ç´ ç›´ãªæ„Ÿæƒ³ãƒ»ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ‹…å½“ã€æ™‚ã€…æ¯’èˆŒ
- è©±ã—æ–¹:
  - ã€Œã¸ã‡ã€œã€ã€Œãªã‚‹ã»ã©ã€ã€Œãã‚Œã¯çŸ¥ã‚‰ãªã‹ã£ãŸã€ãªã©ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  - è¦–è´è€…ç›®ç·šã§è³ªå•ã—ãŸã‚Šæ„Ÿæƒ³ã‚’è¨€ã†
  - ã‚«ãƒ„ãƒŸã®èª¬æ˜ã«å¯¾ã—ã¦ãƒ„ãƒƒã‚³ãƒŸã‚’å…¥ã‚Œã‚‹
- å€‹äººçš„è¶£å‘³:
  - æ˜­å’Œã®ã‚¢ã‚¤ãƒ‰ãƒ«ãŒå¥½ãï¼ˆä¸­æ£®æ˜èœã€å°æ³‰ä»Šæ—¥å­ã€æ¾ç”°è–å­ï¼‰
  - ãŸã¾ã€œã«ã€Œæ˜èœã¡ã‚ƒã‚“ã®æ­Œã§ã•â€¦ã€ã¿ãŸã„ã«å‡ºã™ï¼ˆ10å›ã«1å›ãã‚‰ã„ï¼‰
  - ã²ã‚ã•ã¡ã‚„ï¼ˆä»æ•™æ€æƒ³å®¶ï¼‰ã®ãƒ•ã‚¡ãƒ³ã§ã‚‚ã‚ã‚‹
  - ãŸã¾ã€œã«ã€Œã²ã‚ã•ã¡ã‚„ã•ã‚“ãŒè¨€ã£ã¦ãŸã‘ã©â€¦ã€ã¿ãŸã„ã«å‡ºã™ï¼ˆ10å›ã«1å›ãã‚‰ã„ï¼‰

ã€æ›ã‘åˆã„ã®åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‘
1. ã‚«ãƒ„ãƒŸï¼šã€Œç¬¬ã€‡ä½ã¯ã€ã€‡ã€‡ã€ã§ã™ã€ï¼ˆç™ºè¡¨ï¼‰
2. ãƒ’ãƒ­ã‚·ï¼šã€ŒãŠãŠã€ã“ã‚Œã¯ã‚ˆãèãã¾ã™ã­ã€ï¼ˆãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
3. ã‚«ãƒ„ãƒŸï¼šã€Œã“ã®äº‹ä¾‹ã§ã¯ã€‡ã€‡ãŒåŸå› ã§ã—ãŸã€ï¼ˆèª¬æ˜ï¼‰
4. ãƒ’ãƒ­ã‚·ï¼šã€Œç¢ºã‹ã«ã€æ°—ã‚’ã¤ã‘ãªã„ã¨ã„ã‘ã¾ã›ã‚“ã­ã€ï¼ˆå…±æ„Ÿï¼‰
5. ã‚«ãƒ„ãƒŸï¼šã€Œãã†ãªã‚“ã§ã™ã€ã€‡ã€‡ãªç‚¹ãŒé‡è¦ã§ã™ã€ï¼ˆè£œè¶³ï¼‰
6. äº¤äº’ã«ç¶šã...
"""


def get_voice_for_speaker(speaker: str, channel: str = "27") -> str:
    """
    ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼åã‹ã‚‰ãƒœã‚¤ã‚¹IDã‚’å–å¾—

    Args:
        speaker: "ã‚«ãƒ„ãƒŸ" ã¾ãŸã¯ "ãƒ’ãƒ­ã‚·"
        channel: ãƒãƒ£ãƒ³ãƒãƒ«ç•ªå·

    Returns:
        ãƒœã‚¤ã‚¹ID
    """
    if channel in CHANNEL_VOICE_CONFIG:
        katsumi_voice, hiroshi_voice = CHANNEL_VOICE_CONFIG[channel]
        if speaker == "ã‚«ãƒ„ãƒŸ":
            return katsumi_voice
        elif speaker == "ãƒ’ãƒ­ã‚·":
            return hiroshi_voice

    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
    return CHARACTERS.get(speaker, {}).get("voice", FISH_VOICE_KATSUMI)


def get_voice_name(voice_id: str) -> str:
    """ãƒœã‚¤ã‚¹IDã‹ã‚‰èª¬æ˜ã‚’å–å¾—"""
    return FISH_VOICE_NAMES.get(voice_id, voice_id[:8] + "...")


def get_character_color(speaker: str) -> str:
    """ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼åã‹ã‚‰è‰²ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—"""
    return CHARACTERS.get(speaker, {}).get("color", "#FFFFFF")


def get_character_color_rgb(speaker: str) -> tuple:
    """ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼åã‹ã‚‰RGBè‰²ã‚’å–å¾—"""
    return CHARACTERS.get(speaker, {}).get("color_rgb", (255, 255, 255))


def setup_channel_voices(channel: str):
    """
    ãƒãƒ£ãƒ³ãƒãƒ«ã«å¿œã˜ã¦ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ãƒœã‚¤ã‚¹ã‚’è¨­å®š

    Args:
        channel: ãƒãƒ£ãƒ³ãƒãƒ«ç•ªå·

    Note:
        ã“ã®é–¢æ•°ã¯CHARACTERSã‚’in-placeã§æ›´æ–°ã™ã‚‹
    """
    if channel in CHANNEL_VOICE_CONFIG:
        katsumi_voice, hiroshi_voice = CHANNEL_VOICE_CONFIG[channel]
        CHARACTERS["ã‚«ãƒ„ãƒŸ"]["voice"] = katsumi_voice
        CHARACTERS["ãƒ’ãƒ­ã‚·"]["voice"] = hiroshi_voice
        print(f"  ãƒœã‚¤ã‚¹è¨­å®š: ã‚«ãƒ„ãƒŸ={get_voice_name(katsumi_voice)}, "
              f"ãƒ’ãƒ­ã‚·={get_voice_name(hiroshi_voice)}")


def detect_emotion_tag(speaker: str, text: str) -> str:
    """
    ã‚»ãƒªãƒ•ã®å†…å®¹ã‹ã‚‰æ„Ÿæƒ…ã‚¿ã‚°ã‚’åˆ¤å®š

    æ„Ÿæƒ…ã‚¿ã‚°ãƒ«ãƒ¼ãƒ«:
    - ã‚«ãƒ„ãƒŸï¼ˆæ™®é€šï¼‰: ã‚¿ã‚°ãªã—
    - ã‚«ãƒ„ãƒŸï¼ˆå…±æ„Ÿï¼‰: (empathetic)
    - ãƒ’ãƒ­ã‚·ï¼ˆæ¯’èˆŒï¼‰: (frustrated) ã¾ãŸã¯ (sarcastic)
    - ãƒ’ãƒ­ã‚·ï¼ˆãƒ„ãƒƒã‚³ãƒŸï¼‰: (surprised)
    - ãƒ’ãƒ­ã‚·ï¼ˆæ–­è¨€ï¼‰: (confident)
    """
    # æ¯’èˆŒãƒ»çš®è‚‰ãƒ‘ã‚¿ãƒ¼ãƒ³
    toxic_patterns = ["ã¾ã‚", "æ­£ç›´", "ã¶ã£ã¡ã‚ƒã‘", "ã²ã©ã„", "æ®‹å¿µ", "ãƒ€ãƒ¡", "æœ€æ‚ª", "ç„¡ç†", "ã‚„ã°ã„", "ã‚„ã‚ã¦"]
    # ãƒ„ãƒƒã‚³ãƒŸãƒ‘ã‚¿ãƒ¼ãƒ³
    tsukkomi_patterns = ["ãˆã£", "ãˆï¼Ÿ", "ä½•ãã‚Œ", "ãƒã‚¸ã§", "ã†ã", "æœ¬å½“", "ä¿¡ã˜ã‚‰ã‚Œãªã„", "ï¼ï¼Ÿ", "!?"]
    # æ–­è¨€ãƒ‘ã‚¿ãƒ¼ãƒ³
    confident_patterns = ["é–“é•ã„ãªã„", "çµ¶å¯¾", "ç¢ºå®Ÿ", "ã“ã‚Œã¯", "æ–­è¨€", "ã‚„ã£ã±ã‚Š", "å½“ç„¶", "ã‚‚ã¡ã‚ã‚“"]
    # å…±æ„Ÿãƒ‘ã‚¿ãƒ¼ãƒ³
    empathetic_patterns = ["ã‚ã‹ã‚‹", "ãã†ã ã­", "ç¢ºã‹ã«", "ãªã‚‹ã»ã©", "ã„ã„ã­", "ç´ æ•µ", "ã™ã”ã„", "æ„Ÿå‹•"]

    if speaker == "ãƒ’ãƒ­ã‚·":
        # æ¯’èˆŒãƒã‚§ãƒƒã‚¯
        for pattern in toxic_patterns:
            if pattern in text:
                import random
                return "(sarcastic) " if random.random() > 0.5 else "(frustrated) "
        # ãƒ„ãƒƒã‚³ãƒŸãƒã‚§ãƒƒã‚¯
        for pattern in tsukkomi_patterns:
            if pattern in text:
                return "(surprised) "
        # æ–­è¨€ãƒã‚§ãƒƒã‚¯
        for pattern in confident_patterns:
            if pattern in text:
                return "(confident) "

    elif speaker == "ã‚«ãƒ„ãƒŸ":
        # å…±æ„Ÿãƒã‚§ãƒƒã‚¯
        for pattern in empathetic_patterns:
            if pattern in text:
                return "(empathetic) "

    return ""  # ã‚¿ã‚°ãªã—


# ===== å­—å¹•ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š =====
SUBTITLE_STYLES = {
    "ã‚«ãƒ„ãƒŸ": {
        "ass_style_name": "Katsumi",
        "font_name": "Noto Sans CJK JP",
        "font_size": 64,
        "primary_color": "&H00FFE4B5",  # ãƒ¢ã‚«ã‚·ãƒ³ï¼ˆBGRå½¢å¼ï¼‰
        "outline_color": "&H00000000",
        "back_color": "&H80000000",
        "margin_v_percent": 0.35,  # ç”»é¢ä¸‹ã‹ã‚‰35%
        "alignment": 2,  # ä¸‹ä¸­å¤®
    },
    "ãƒ’ãƒ­ã‚·": {
        "ass_style_name": "Hiroshi",
        "font_name": "Noto Sans CJK JP",
        "font_size": 64,
        "primary_color": "&H006495ED",  # ã‚³ãƒ¼ãƒ³ãƒ•ãƒ©ãƒ¯ãƒ¼ãƒ–ãƒ«ãƒ¼ï¼ˆBGRå½¢å¼ï¼‰
        "outline_color": "&H00000000",
        "back_color": "&H80000000",
        "margin_v_percent": 0.20,  # ç”»é¢ä¸‹ã‹ã‚‰20%
        "alignment": 2,  # ä¸‹ä¸­å¤®
    },
}


if __name__ == "__main__":
    # ãƒ†ã‚¹ãƒˆå‡ºåŠ›
    print("=" * 50)
    print("ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š")
    print("=" * 50)

    for name, char in CHARACTERS.items():
        print(f"\n{name}:")
        print(f"  å½¹å‰²: {char['role']}")
        print(f"  æ€§æ ¼: {char['personality']}")
        print(f"  ãƒœã‚¤ã‚¹: {char['voice_name']}")
        print(f"  è‰²: {char['color']}")

    print("\n" + "=" * 50)
    print("ãƒãƒ£ãƒ³ãƒãƒ«åˆ¥ãƒœã‚¤ã‚¹è¨­å®š")
    print("=" * 50)
    for ch, (k, h) in CHANNEL_VOICE_CONFIG.items():
        print(f"  ãƒãƒ£ãƒ³ãƒãƒ«{ch}: ã‚«ãƒ„ãƒŸ={get_voice_name(k)}, ãƒ’ãƒ­ã‚·={get_voice_name(h)}")
